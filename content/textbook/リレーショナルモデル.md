---
title: "リレーショナルモデル"
date: 2022-12-26T09:51:50+09:00
draft: false
description: "理解しているようで、理解できていない、リレーショナルモデルについてです。"
categories: ["DB2023", "教科書"]
tags: ["リレーショナルモデル", "SQL"]
---

## リレーショナルモデル

関係モデルとも呼ばれます。  
現実世界に存在するデータを「リレーション(関係)」と呼ばれる概念によって表現するモデルです。  

> 関係モデルとは、データの集合を表現する数学的なモデルの一つ。データ群を複数の項目の「関係」（relation）として捉えるもので、リレーショナルデータベース（RDB）の理論上の基礎となっている。  
> 関係モデルでは、一件のデータを複数の値を紐付けた「組」（tuple）として表現する。それぞれの値は「属性」（attribute）に所属しており、組の中では属性名を使って指し示すことができる。各属性はどのような値を取りうるかを定めた定義域（domain）を持つ。  
> [e-words](https://e-words.jp/w/関係モデル.html)より。  

## リレーション

関係DBではリレーションは**テーブル**に該当します。  
テーブルは「ヘッダ」と「本体(ボディ)」から構成されます。  

ヘッダはn個の属性(Attribute)の集合であり、本体は組(タプル)の集合です。  

---

ポケモン図鑑テーブルの例では、ヘッダとして「図鑑暗号: 整数」「名前: 文字列」「世代: 整数」があり、本体には「(25, 'ピカチュウ', 1)」「(152, 'チコリータ', 2)」などのタプルが格納されます。  

このような関係がリレーションです。  

### NULL問題

ポケモン図鑑のテーブルの見出しを「図鑑暗号: 整数」「名前: 文字列」「タイプ1: 文字列」「タイプ2: 文字列」に修正します。  
この場合、フシギバナは「(3, 'フシギバナ', 'くさ', 'どく')」となりますが、ピカチュウは「(25, 'ピカチュウ', 'でんき')」となり、ヘッダで定義された属性の集合との不一致が発生します。  

このようなヘッダと本体の不一致はリレーションとして不適切とみなされます。  

これを解決するために、NULLという概念を使用して「(25, 'ピカチュウ', 'でんき', NULL)」と表現することができますが、これはリレーションとして適切なのかについては諸説あります。  

---

リレーションは属性の集合である見出しと、当該見出しと一致する定義域を有するタプルの集合であるため、結果的にExcelのような表の形式で表現され、したがって、これを操作するためのSQLが使用されますが、根底にはリレーションとそれをモデル化したリレーショナルモデルという考え方があります。  

これを把握するとSQLで実行される集合演算(和・差・直積・積・商)やSELECT対象、WHERE句による射影と選択が少し違って見えるかもしれません、、、  

## 集合

リレーションは集合として合わらすことができます。  
数学Aで習った**あの**集合です。  

![集合](../img/data-set.png)  
<!-- https://mmsankosho.com/bubunshugonikushugogahukumarerunohanaze/ -->

したがって、集合演算も当然に適用可能です。  

既に学習済みですが、代表的な集合演算として以下のものがあります。  

- 和
- 差
- 直積
- 積
- 商

### 選択

「選択」によって集合の中から特定の条件に合う要素(タプル)だけを抽出することができます。  
この時、新たに生成される集合は元の集合と同一であることも考えられますし、空集合であることも考えられます。  

これはWHERE句で実現します。  

```sql
SELECT number, name
FROM pokemon
WHERE generation = 1;
```

### 射影

「射影」によって要素(タプル)のうち、特定の属性からなる新たな集合を生成することもできます。  
この場合には、集合の性質上、要素が完全に異なるものが出現しないように注意が必要です。  

例えば、ポケモン図鑑テーブルから以下のSQLを実行してタイプ一覧を表示したとします。  

```sql
SELECT type1
FROM pokekon;
```

タイプ1がくさであるポケモンは複数存在しますから、くさタイプという要素がひとつの集合内で複数存在することになります。  
これは集合の性質に違反していますので、原則として射影時にはDISTINCT句を付けるべきといえます。  

パフォーマンスの観点から付けないことが多いですが、、、  

```sql
SELECT DISTINCT type1
FROM pokekon;
```

もとの集合に関しても当然に要素の重複は許されません。  

### 集合の拡張

拡張は射影とは逆に属性を追加する集合演算です。  
例えば、全てのステータスを合計してトータルという属性を新たに生成する演算が該当します。  

```sql
SELECT hp, attack, defence, sp_attack, sp_defence, speed, (hp + attack + defence + sp_attack + sp_defence + speed) AS total
FROM pokemon;
```

### ヘッダのリネーム

ヘッダに別名を付けることもできます。  
AS句が該当します。  

```sql
SELECT number AS id
FROM pokemon;
```

### 集合の性質

集合には以下の性質があります  

- 要素間での順番は存在しない。
- 要素の重複は存在しない。

## ドメイン

集合に属する要素が取りうる値の範囲のことで、定義域とも呼ばれます。  
一般的にはデータ型が該当しますが、既に説明したとおり、データ型に対して制約を課すことでより詳細にその値を指定することができます。  

例えば、郵便番号は文字列として格納されますが、「xxx-xxxx」の形式を満たす必要があります。  
このような場合に、定義域を使用することで「xxx-xxxx」の形式を満たさないデータを排除することができます。  

定義域は以下のように定義します。  

```sql
CREATE DOMAIN 定義域名
AS データ型
CHECK(...);
```

例えば、郵便番号用の定義域は以下のように定義することができます。  

```sql
CREATE DOMAIN postal_code
AS CHAR(8)
CHECK(postal_code LIKE '___-____');

---

[カラム(SQLとリレーショナルモデル)](../column/SQLとリレーショナルモデル.md)  
