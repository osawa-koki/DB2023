---
title: "データ定義言語"
date: 2022-12-25T21:39:06+09:00
draft: false
description: "自分でイチから作らないと使う機会が少ない、データ定義言語についてです。"
categories: ["DB2023", "教科書"]
tags: ["SQL", "論理設計"]
---

## データ定義言語

「Data Definition Language」の略です。  

データベース・テーブル・ビューに関する定義や、それらに関する権限の設定を行うためのSQLです。  
以下のメソッドが該当します。  

| メソッド | 説明 |
| ---- | ---- |
| CREATE | データベース・テーブル・ビューを定義する。 |
| ALTER | データベース・テーブル・ビューの定義を変更する。 |
| DROP | データベース・テーブル・ビューを削除する。 |

## CREATE文

テーブル・ビューなどの資源を新規作成する際に使用されるSQLです。  
具体的にはCREATE文では以下の資源を作成することができます。  

- DATABASE (データベース)
- TABLE (テーブル)
- VIEW (ビュー)
- ROLE (ロール)
- TRIGGER (トリガー)

### CREATE TABLE

テーブルを新規に作成します。  

```sql
CREATE TABLE テーブル名 (
  列名1 データ型 [列制約定義],
  列名2 データ型 [列制約定義],
  列名3 データ型 [列制約定義],
  [テーブル制約定義]
);
```

#### データ型

データベースで使用可能なデータ型はRDBMSによって異なりますが、基本的には以下の5つからなります。  

- 整数型 (INTEGER/SMALLINT)
- 小数型 (FLOAT/DECIMAL)
- 文字列型 (CHAR/VARCHAR/NCHAR/NVARCHAR)
- 日付型 (DATE/DATETIME/TIME)
- バイト型 (BLOB)

また、文字列型に関しては固定バイト数文字列型(CHAR)と可変バイト数文字列型(VARCHAR)に分けられ、また格納対象となる文字によって半角(CHAR/VARCHAR)と全角(NCHAR/NVARCHAR)に分類されます。  

#### 制約

列またはテーブル全体に対して格納する値に関して制約を課すことができます。  
以下の制約が使用可能です。  

| 制約名 | キーワード | 説明 |
| ---- | ---- | ---- |
| 非ナル制約 | NOT NULL | NULLの代入を禁止する制約。 |
| デフォルト値 | DEFAULT | 値が代入されない場合に既定で代入される値の設定。 |
| 一意性制約 | UNIQUE | 指定した列、または列の組み合わせが当該テーブルで一意であることを約束する制約。 |
| 主キー制約 | PRIMARY KEY | 非ナル制約 + 一意性制約 ( + インデックス) |
| 検査制約 | CHECK | 代入される値に対して条件を設定。 |
| 参照制約 | FOREIGN KEY | 外部テーブルを参照している場合に、2つのデーブル間での整合性を保つための制約。 |

```sql
CREATE TABLE pokemon(
  number INTEGER PRIMARY KEY,
  name NVARCHAR(5) UNIQUE,
  type1 NVARCHAR(5) NOT NULL,
  type2 NVARCHAR(5),
  is_valid INTEGER DEFAULT 1,
  hp INTEGER NOT NULL CHECK(0 < hp),
  ...
);
```

また、制約にはCONSTRAINTキーワードを使用して任意の名前を付けることができます。  
これは後から修正する場合に役立ちます。  

##### 参照制約

外部テーブルを参照している場合に、2つのデーブル間での整合性を保つための制約で、**参照元テーブルに外部キーを設定し、参照制約を課す**ことでテーブル間の整合性を保証します。  

参照先でのデータの変更に際しては以下の処理が設定可能です。  

| オプション | 説明 |
| ---- | ---- |
| NO ACTION | 参照元にデータが存在している場合に、参照先のデータの変更(更新・削除)を拒否。  (デフォルト) |
| CASCADE | 参照元にデータが存在している場合に、参照先のデータの変更(更新・削除)した場合に、参照元のデータも連携して削除。 |
| SET NULL | 参照元にデータが存在している場合に、参照先のデータの変更(更新・削除)した場合に、参照元のデータにNULLをセット。 |

例えば、pokemonテーブルでポケモン図鑑を、my_pokemonテーブルで自分がゲットしたポケモンを管理するとします。  

```sql
CREATE TABLE my_pokemon(
  id INTEGER PRIMARY KEY,
  number INTEGER NOT NULL CHECK(0 < number AND number <= 1008),
  nickname NVARCHAR(5) NOT NULL,
  FOREIGN KEY(number)
  REFERENCES pokemon(number)
  ON UPDATE SET NULL,
  ON DELETE CASCADE,
);
```

ポケモン図鑑で削除された場合、自分がそのポケモンを仲間にしているのはダメですよね、、、  
実際にはポケモン図鑑から削除されることはありませんが、、、  

万が一、ポケモン図鑑のポケモンが変更(更新・削除)された場合には、それに応じて自分がゲットしたポケモンのデータも修正する必要があります。  
上の例では、ポケモン図鑑が更新された場合には、対象となるポケモンの値をNULLにセットし、ポケモン図鑑からポケモンが削除された場合には自分のデータからも削除しています。  

##### 表明

テーブルをまたぐような複雑な制約を課すことができます。  
アサーション(ASSERTION)と呼びます。  

例えば、`テーブルAとテーブルBのカラムXの最大値はテーブルCのカラムYの最大値よりも小さい`などといったものです。  
このような複雑な制約はアサーションで定義できます。  

```sql
CREATE ASSERTION アサーション名
CHECK NOT EXISTS(
  SELECT *
  ...
);
```

使用する機会はあまりありませんが、出題されたことがある内容ですので、一応、、、  

##### 定義域

ドメインとも呼びます。  
自分自身で定義するデータ型と説明されることもあります。  

例えば、郵便番号は文字列として格納されますが、「xxx-xxxx」の形式を満たす必要があります。  
このような場合に、定義域を使用することで「xxx-xxxx」の形式を満たさないデータを排除することができます。  

定義域は以下のように定義します。  

```sql
CREATE DOMAIN 定義域名
AS データ型
CHECK(...);
```

例えば、郵便番号用の定義域は以下のように定義することができます。  

```sql
CREATE DOMAIN postal_code
AS CHAR(8)
CHECK(postal_code LIKE '___-____');
```

### CREATE VIEW
