<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="https://osawa-koki.github.io/DB2023/Logo.png" type="image/x-icon" />
  
  <link rel="stylesheet" href="https://osawa-koki.github.io/DB2023/sass/style.min.dc0078058ce9074c96338ad888d8e91b59fba1e714614cf45118578944e151d7.css" />
  
  <link rel="stylesheet" href="https://osawa-koki.github.io/DB2023/sass/single.min.3b930d67d16a1c09a9dfba0df903c9a279dfcadbd9d8c4479def4c7a14e91547.css" />
  
  <link rel="stylesheet" href="https://osawa-koki.github.io/DB2023/sass/content.min.29f09606f5140407d848c87a91f73509241b381546612af92f28f53e2fd2de65.css" />
  <link rel="stylesheet" href="https://osawa-koki.github.io/DB2023/bootstrap-5.0.2-dist/css/bootstrap.min.css" />
  <title>埋込み型SQL | データベーススペシャリスト試験対策</title>
</head>
<body>
  <header>
    <a href="https://osawa-koki.github.io/DB2023/"><img id="LogoImage" src="https://osawa-koki.github.io/DB2023/Logo.png" alt="Logo" /></a>
  </header>
  <main>

<div id="Single">
  <div id="MainDiv">
    <div id="content-header">
      <div id="content-title">埋込み型SQL</div>
      <div id="content-description">プログラミング言語から直接使用するSQLについてです。最近はカーソルとか意識しなくてもよくなっているので、忘れがちですね、、、</div>
      <div id="content-date">2022.12.25</div>
      <div id="content-categories">
        
          <div class="category">DB2023</div>
        
          <div class="category">教科書</div>
        
      </div>
      <div id="content-tags">
        
          <div class="tag">SQL</div>
        
      </div>
    </div>
    <div id="MainBody">
      <div id="content">
        <h2 id="埋込み型sql会話型sql">埋込み型SQL・会話型SQL</h2>
<p>SSMSなどで直接ユーザが実行するSQLを会話型SQLと呼びます。<br>
それに対してプログラミング言語から直接実行するSQLを埋込み型SQLと呼びます。</p>
<p>最近はデータベース操作に関するラッパーライブラリが充実しているため、プログラムから簡単にSQLを実行、結果を取得できますが、試験では詳細に問われることがあるため、簡単に説明します。</p>
<h2 id="カーソル">カーソル</h2>
<p>SELECT文の結果が複数行になる場合には、プログラミング言語では複数行を操作することができないため、カーソルを操作することで複数行の結果を扱います。</p>
<p>下のコード(PHP)では<code>while ($row = $stmt-&gt;fetch())</code>の部分で結果がある限り、カーソルをひとつずつ下に下げることで複数行を処理しています。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$pdo <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">PDO</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;mysql:dbname=testdb;host=localhost;charset=utf8mb4&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;root&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;password&#39;</span>,
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>$stmt <span style="color:#f92672">=</span> $pdo<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;SELECT number, name FROM pokemon;&#39;</span>);
</span></span><span style="display:flex;"><span>$stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">execute</span>();
</span></span><span style="display:flex;"><span><span style="color:#75715e">// カーソルをひとつずつ下げていく。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">while</span> ($row <span style="color:#f92672">=</span> $stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">fetch</span>()) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%s - %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, $row[<span style="color:#e6db74">&#39;number&#39;</span>], $row[<span style="color:#e6db74">&#39;name&#39;</span>]);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="カーソル操作">カーソル操作</h2>
<p>今更、cobolなんて、、、<br>
って思いますが、考古学として一応紹介します。</p>
<h3 id="exec-sql---end-exec">EXEC SQL - END-EXEC</h3>
<p><code>EXEC SQL</code>でSQL文の開始を、<code>END-EXEC</code>でSQL文の終わりを表します。</p>
<h3 id="declare-カーソル名-cursor-for">DECLARE カーソル名 CURSOR FOR</h3>
<p><code>DECLARE カーソル名 CURSOR FOR</code>でカーソル変数を定義します。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cobol" data-lang="cobol"><span style="display:flex;"><span><span style="color:#75715e">EXEC S</span>QL<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">DECLAR</span>E C1 <span style="color:#66d9ef">CURSOR</span> <span style="color:#66d9ef">FOR</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">SELECT</span> <span style="color:#66d9ef">number</span>, name<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">  FROM</span> pokemon<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">END-EX</span>EC<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><h3 id="open---fetch---close">OPEN - FETCH - CLOSE</h3>
<p><code>OPEN</code>でカーソル処理を開始し、<code>FETCH</code>でカーソルからデータを取り出し、<code>CLOSE</code>でカーソル操作を終了します。<br>
また、SQLSTATE変数を使用してSQLの実行の成功・失敗を判断します。</p>
<h3 id="where-current-of-カーソル名">WHERE CURRENT OF カーソル名</h3>
<p>UPDATE文とDELETE文に関しては対象のカーソル位置に関して行う処理であるため、実行に関してはカーソル位置を伝える必要があります。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cobol" data-lang="cobol"><span style="display:flex;"><span><span style="color:#75715e">EXEC S</span>QL<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">UPDATE</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  ...<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">  WHER</span>E CURRENT <span style="color:#66d9ef">OF </span><span style="color:#960050;background-color:#1e0010">カーソル名
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">END-EX</span>EC<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cobol" data-lang="cobol"><span style="display:flex;"><span><span style="color:#75715e">EXEC S</span>QL<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">DELETE</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  ...<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">  WHER</span>E CURRENT <span style="color:#66d9ef">OF </span><span style="color:#960050;background-color:#1e0010">カーソル名
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">END-EX</span>EC<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><h3 id="commit">COMMIT</h3>
<p>トランザクションを使用する場合には、<code>COMMIT (WORK)</code>、<code>ROLLBACK (WORK)</code>を使用します。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cobol" data-lang="cobol"><span style="display:flex;"><span><span style="color:#75715e">EXEC S</span>QL<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">COMMIT</span> (WORK)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">END-EX</span>EC<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cobol" data-lang="cobol"><span style="display:flex;"><span><span style="color:#75715e">EXEC S</span>QL<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">ROLLBA</span>CK (WORK)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">END-EX</span>EC<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>SQL92では<code>COMMIT (WORK)</code>、<code>ROLLBACK (WORK)</code>の<code>WORK</code>を省略して、<code>COMMIT ()</code>、<code>ROLLBACK ()</code>と書くことができます。</p>

      </div>
    </div>
  </div>





  <div id="SubDiv">
    <div id="Menu">
      <div class="title">教科書</div>
      
        
        
        
        
        
        
        
        
          <a href="https://osawa-koki.github.io/DB2023/textbook/%e3%83%9b%e3%83%bc%e3%83%a0">ホーム</a>
        
        
        
      
        
        
        
        
        
        
        
        
          <a href="https://osawa-koki.github.io/DB2023/textbook/%e3%83%87%e3%83%bc%e3%82%bf%e3%83%99%e3%83%bc%e3%82%b9%e5%9f%ba%e7%a4%8e">データベース基礎</a>
        
        
        
      
        
        
        
        
        
        
        
        
          <a href="https://osawa-koki.github.io/DB2023/textbook/SQL%e3%81%ae%e7%a8%ae%e9%a1%9e">SQLの種類</a>
        
        
        
      
        
        
        
        
        
        
        
        
          <a href="https://osawa-koki.github.io/DB2023/textbook/%e3%83%87%e3%83%bc%e3%82%bf%e6%93%8d%e4%bd%9c%e8%a8%80%e8%aa%9e">データ操作言語</a>
        
        
        
      
        
        
        
        
        
        
        
        
          <a href="https://osawa-koki.github.io/DB2023/textbook/%e3%83%86%e3%83%bc%e3%83%96%e3%83%ab%e3%81%ae%e7%b5%90%e5%90%88">テーブルの結合</a>
        
        
        
      
        
        
        
        
        
        
        
        
          <a href="https://osawa-koki.github.io/DB2023/textbook/%e9%9b%86%e5%90%88%e6%bc%94%e7%ae%97">集合演算</a>
        
        
        
      
        
        
        
        
        
        
        
        
          <a href="https://osawa-koki.github.io/DB2023/textbook/%e5%89%af%e5%95%8f%e3%81%84%e5%90%88%e3%82%8f%e3%81%9b">副問い合わせ</a>
        
        
        
      
        
        
        
        
        
        
        
        
          <a href="https://osawa-koki.github.io/DB2023/textbook/%e3%83%87%e3%83%bc%e3%82%bf%e5%ae%9a%e7%be%a9%e8%a8%80%e8%aa%9e">データ定義言語</a>
        
        
        
      
        
        
        
        
        
        
        
        
          <a href="https://osawa-koki.github.io/DB2023/textbook/%e3%83%87%e3%83%bc%e3%82%bf%e5%88%b6%e5%be%a1%e8%a8%80%e8%aa%9e">データ制御言語</a>
        
        
        
      
        
        
        
        
        
        
        
        
          <a href="https://osawa-koki.github.io/DB2023/textbook/%e5%9f%8b%e8%be%bc%e3%81%bf%e5%9e%8bSQL" class="active">埋込み型SQL</a>
          
          
        
        
        
      
      
      
      
      <div class="title">カラム</div>
      
        
        
        
          
          
          
        
        
        
        
        
        
          <a href="https://osawa-koki.github.io/DB2023/column/%e5%87%ba%e9%a1%8c%e5%82%be%e5%90%91">出題傾向</a>
        
        
        
      
    </div>
  </div>
</div>
<div>
  <div id="ButtonContainer">
    
      <a class="btn btn-outline-success" href="https://osawa-koki.github.io/DB2023/textbook/%e3%83%87%e3%83%bc%e3%82%bf%e5%88%b6%e5%be%a1%e8%a8%80%e8%aa%9e" id="PrevButton">前へ</a>
    
    
      <a class="btn btn-outline-primary" href="https://osawa-koki.github.io/DB2023/column/%e5%87%ba%e9%a1%8c%e5%82%be%e5%90%91" id="NextButton">次へ</a>
    
  </div>
</div>
  </main>
<footer>
</footer>
</body>
</html>

